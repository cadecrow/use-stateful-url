<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>useStatefulUrl - Delimiter Demo</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px;
            line-height: 1.6;
        }
        .demo-section { 
            margin: 20px 0; 
            padding: 20px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            background: #f9f9f9;
        }
        .url-display { 
            background: #e8f4fd; 
            padding: 10px; 
            border-radius: 4px; 
            font-family: monospace; 
            word-break: break-all;
            margin: 10px 0;
        }
        input, button { 
            padding: 8px 12px; 
            margin: 5px; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
        }
        button { 
            background: #0066cc; 
            color: white; 
            cursor: pointer; 
        }
        button:hover { background: #0052a3; }
        .hash-parts {
            margin: 10px 0;
            padding: 10px;
            background: #fff;
            border-radius: 4px;
            border: 1px solid #eee;
        }
        .hash-part {
            margin: 5px 0;
            font-family: monospace;
        }
        .existing { color: #e74c3c; }
        .uhs { color: #27ae60; }
        .label { font-weight: bold; margin-right: 10px; }
    </style>
</head>
<body>
    <h1>ðŸ”— useStatefulUrl Delimiter Demo</h1>
    
    <p>This demo shows how useStatefulUrl coexists with existing hash parameters using delimiters.</p>
    
    <div class="demo-section">
        <h2>Current URL Hash</h2>
        <div class="url-display" id="current-url"></div>
        
        <div class="hash-parts">
            <div class="hash-part">
                <span class="label existing">Existing Hash:</span>
                <span id="existing-hash"></span>
            </div>
            <div class="hash-part">
                <span class="label uhs">useStatefulUrl Content:</span>
                <span id="uhs-content"></span>
            </div>
        </div>
    </div>
    
    <div class="demo-section">
        <h2>Existing Hash Parameters (Simulated)</h2>
        <p>These represent hash parameters your app might already be using:</p>
        
        <label>
            Tab: 
            <select id="tab-select">
                <option value="dashboard">Dashboard</option>
                <option value="profile">Profile</option>
                <option value="settings">Settings</option>
            </select>
        </label>
        
        <label>
            Debug Mode:
            <input type="checkbox" id="debug-checkbox"> Enabled
        </label>
        
        <button onclick="updateExistingHash()">Update Existing Hash</button>
    </div>
    
    <div class="demo-section">
        <h2>useStatefulUrl Demo</h2>
        <p>These parameters are managed by useStatefulUrl and isolated with delimiters:</p>
        
        <label>
            Search Query:
            <input type="text" id="search-input" placeholder="Type to search...">
        </label>
        
        <label>
            Filter Tags:
            <div>
                <label><input type="checkbox" class="tag-checkbox" value="react"> React</label>
                <label><input type="checkbox" class="tag-checkbox" value="vue"> Vue</label>
                <label><input type="checkbox" class="tag-checkbox" value="angular"> Angular</label>
                <label><input type="checkbox" class="tag-checkbox" value="svelte"> Svelte</label>
            </div>
        </label>
        
        <button onclick="clearuseStatefulUrl()">Clear useStatefulUrl Only</button>
        <button onclick="clearAllHash()">Clear All Hash</button>
    </div>

    <script>
        // Simplified useStatefulUrl implementation for demo
        const DEFAULT_DELIMITERS = { start: "__UHS-", end: "-UHS__" };
        
        function extractHashParts(hash, delimiters = DEFAULT_DELIMITERS) {
            const startIndex = hash.indexOf(delimiters.start);
            const endIndex = hash.indexOf(delimiters.end);
            
            if (startIndex === -1 || endIndex === -1 || endIndex <= startIndex) {
                return { before: hash, useStatefulUrl: "", after: "" };
            }
            
            return {
                before: hash.substring(0, startIndex),
                useStatefulUrl: hash.substring(startIndex + delimiters.start.length, endIndex),
                after: hash.substring(endIndex + delimiters.end.length),
            };
        }
        
        function updateHash(uhsParams = {}, delimiters = DEFAULT_DELIMITERS) {
            const currentHash = window.location.hash.substring(1);
            const { before, after } = extractHashParts(currentHash, delimiters);
            
            const urlParams = new URLSearchParams();
            for (const [key, value] of Object.entries(uhsParams)) {
                if (value && value.length > 0) {
                    urlParams.set(key, value);
                }
            }
            
            const stateContent = urlParams.toString();
            
            let newHash = "";
            if (before) newHash += before;
            if (stateContent) {
                newHash += delimiters.start + stateContent + delimiters.end;
            }
            if (after) newHash += after;
            
            window.location.hash = newHash;
        }
        
        function parseuseStatefulUrl(delimiters = DEFAULT_DELIMITERS) {
            const hash = window.location.hash.substring(1);
            const { useStatefulUrl } = extractHashParts(hash, delimiters);
            return new URLSearchParams(useStatefulUrl);
        }
        
        function updateDisplay() {
            const hash = window.location.hash || "#";
            const { before, useStatefulUrl, after } = extractHashParts(hash.substring(1));
            
            document.getElementById('current-url').textContent = window.location.href;
            document.getElementById('existing-hash').textContent = (before + after) || "(none)";
            document.getElementById('uhs-content').textContent = useStatefulUrl || "(none)";
        }
        
        function updateExistingHash() {
            const tab = document.getElementById('tab-select').value;
            const debug = document.getElementById('debug-checkbox').checked;
            
            const currentHash = window.location.hash.substring(1);
            const { useStatefulUrl } = extractHashParts(currentHash);
            
            const existingParams = new URLSearchParams();
            existingParams.set('tab', tab);
            if (debug) existingParams.set('debug', 'true');
            
            let newHash = existingParams.toString();
            if (useStatefulUrl) {
                newHash += DEFAULT_DELIMITERS.start + useStatefulUrl + DEFAULT_DELIMITERS.end;
            }
            
            window.location.hash = newHash;
        }
        
        function updateuseStatefulUrl() {
            const search = document.getElementById('search-input').value;
            const tags = Array.from(document.querySelectorAll('.tag-checkbox:checked')).map(cb => cb.value);
            
            const params = {};
            if (search) params.search = search;
            if (tags.length > 0) params.tags = tags.join(',');
            
            updateHash(params);
        }
        
        function clearuseStatefulUrl() {
            updateHash({});
        }
        
        function clearAllHash() {
            window.location.hash = "";
        }
        
        // Initialize with some existing hash params
        if (!window.location.hash) {
            window.location.hash = "tab=dashboard&debug=true";
        }
        
        // Set up event listeners
        document.getElementById('search-input').addEventListener('input', updateuseStatefulUrl);
        document.querySelectorAll('.tag-checkbox').forEach(cb => {
            cb.addEventListener('change', updateuseStatefulUrl);
        });
        
        // Initialize display and update on hash change
        window.addEventListener('hashchange', () => {
            updateDisplay();
            
            // Sync UI with hash state
            const params = parseuseStatefulUrl();
            document.getElementById('search-input').value = params.get('search') || '';
            
            const selectedTags = params.get('tags')?.split(',') || [];
            document.querySelectorAll('.tag-checkbox').forEach(cb => {
                cb.checked = selectedTags.includes(cb.value);
            });
            
            // Sync existing hash params
            const existingParams = new URLSearchParams(window.location.hash.substring(1));
            const tab = existingParams.get('tab');
            if (tab) document.getElementById('tab-select').value = tab;
            document.getElementById('debug-checkbox').checked = existingParams.get('debug') === 'true';
        });
        
        // Initial load
        window.dispatchEvent(new Event('hashchange'));
    </script>
</body>
</html> 